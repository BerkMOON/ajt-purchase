# Excel 价格计算脚本使用说明（多 Sheet 版本）

## 功能说明

此脚本用于批量计算 Excel 文件中的价格字段，支持多个 Sheet，每个 Sheet 使用不同的折扣率：

### Sheet 1（第一个 Sheet）

- **回采最高限价** = 主机厂采购价(含税) × 0.55（5.5 折）
- **无回采最高限价** = 主机厂采购价(含税) × 0.48（4.8 折）

### Sheet 2（第二个 Sheet）

- **回采最高限价** = 主机厂采购价(含税) × 0.4（4 折）
- **无回采最高限价** = 主机厂采购价(含税) × 0.3（3 折）

### 计算结果

- 所有价格计算结果向下取整，只保留整数部分（抹掉小数部分）

## 安装依赖

```bash
pip install -r scripts/requirements.txt
```

或者单独安装：

```bash
pip install pandas openpyxl
```

## 使用方法

### 基本用法

```bash
python scripts/calculate_prices.py <输入Excel文件>
```

脚本会自动生成输出文件名，格式为：`原文件名_已计算.xlsx`

### 指定输出文件

```bash
python scripts/calculate_prices.py <输入Excel文件> <输出Excel文件>
```

## 示例

```bash
# 基本用法
python scripts/calculate_prices.py data/备件清单.xlsx

# 指定输出文件
python scripts/calculate_prices.py data/备件清单.xlsx data/备件清单_计算结果.xlsx
```

## Excel 文件要求

### 文件结构

- Excel 文件需要包含至少 2 个 Sheet
- 第一个 Sheet 使用 5.5 折和 4.8 折的折扣率
- 第二个 Sheet 使用 4 折和 3 折的折扣率

### 每个 Sheet 需要包含的列

1. **主机厂采购价(含税)** - 必需，用于计算的基础价格

   - 支持变体：`主机厂采购价（含税）`、`主机厂采购价`、`采购价`

2. **回采最高限价** - 可选，如果不存在会自动创建

   - 支持变体：`回采限价`

3. **无回采最高限价** - 可选，如果不存在会自动创建
   - 支持变体：`无回采限价`

## 输出说明

- 脚本会保留原 Excel 文件的所有 Sheet、列和格式
- 计算结果向下取整，只保留整数部分（例如：1924.35 → 1924）
- 如果某行的"主机厂采购价(含税)"为空或无效，对应行的计算结果也会为空
- 处理完成后会在控制台显示每个 Sheet 的统计信息

## 注意事项

1. 确保输入文件是有效的 Excel 文件（.xlsx 格式）
2. 价格数据应为数值类型，脚本会自动处理字符串格式的数字
3. 建议在处理前备份原始文件
4. 如果列名不完全匹配，脚本会尝试查找相似的列名
